@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery
@using ToDoListLibrary
@model ToDoAspNetMvc.ViewModels.ToDoEntryViewModel

@{
    ViewData["Title"] = "Create";
    var requestToken = Antiforgery.GetAndStoreTokens(Context).RequestToken;
}

<h1>Create</h1>

<hr />
<div class="row">
    <div class="col-md-4">
        <form asp-action="Create">
            <input type="hidden" asp-for="OwnerId" value="@ViewBag.Owner" />
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <partial name="_ToDoEntryDetails" />
            <div class="form-group">
                <input type="submit" value="Save" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div>
    <a class="btn btn-default btn-lg" asp-action="Details" asp-controller="ToDoLists" asp-route-id="@ViewBag.Owner">
        <span class="bi bi-arrow-left"></span>Back to List
    </a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <script>
        $(function () {
            $('.DeleteField').click(function () {
                var fieldid = $(this).attr("data-fieldid");
                if (fieldid) {
                    $.ajax({
                        url: '@Url.Action("Delete", "Fields")' + `?id=${fieldid}`,
                        headers: { "RequestVerificationToken": "@requestToken" },
                        type: "POST",
                        cache: false,
                        async: true,
                        success: function (data) {
                            var field = document.getElementById(`Field_${fieldid}`);
                            if (field) {
                                field.style.display = "none";
                            }
                        }
                    });
                }
                else {
                    var fieldid = $(this).attr("data-fieldindex");
                    var field = document.getElementById(`Field_Empty_${fieldid}`);
                    if (field) {
                        field.style.display = "none";
                    }
                }
            });
        });
    </script>
    <script>
        $(function () {
            $('.CreateField').click(function () {
                var fieldid = $(this).attr("data-owner");
                var elements = document.getElementsByClassName("field_form");
                var count = elements.length;
                if (count === 0) { 
                }
                var newNameLabel = document.createElement("input")
                var newSurnameLabel = document.createElement("input")
                var newNameInput = document.createElement("input")
                var newSurnameInput = document.createElement("input")
                newNameLabel.setAttribute("for", "Field_" + count + "__Name")
                newSurnameLabel.setAttribute("for", "Field_" + count + "__Value")
                newNameLabel.innerHTML = "Name"
                newSurnameLabel.innerHTML = "Value"
                newNameInput.setAttribute("id", "Field_" + count + "__Name")
                newSurnameInput.setAttribute("id", "Field_" + count + "__Value")
                newNameInput.setAttribute("class", "name")
                newSurnameInput.setAttribute("class", "surname")
                newNameInput.setAttribute("name", "People[" + count + "].Name")
                newSurnameInput.setAttribute("name", "People[" + count + "].Value")
                newNameInput.setAttribute("type", "text")
                newSurnameInput.setAttribute("type", "text")
                document.getElementsByTagName("form")[0].append(newNameLabel)
                document.getElementsByTagName("form")[0].append(newNameInput)
                document.getElementsByTagName("form")[0].append(document.createElement("br"))
                document.getElementsByTagName("form")[0].append(newSurnameLabel)
                document.getElementsByTagName("form")[0].append(newSurnameInput)
                document.getElementsByTagName("form")[0].append(document.createElement("br"))
            });
        });
    </script>
}
